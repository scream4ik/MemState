
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Transactional Memory for AI Agents - Keep SQL and Vector DBs in sync with ACID-like guarantees">
      
      
      
        <link rel="canonical" href="https://scream4ik.github.io/memstate/api/memstate/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../backends/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>MemState - MemState</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#memstate.storage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MemState" class="md-header__button md-logo" aria-label="MemState" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MemState
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MemState
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/scream4ik/MemState" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    scream4ik/MemState
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../documentation/" class="md-tabs__link">
          
  
  
  Documentation

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MemState" class="md-nav__button md-logo" aria-label="MemState" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MemState
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/scream4ik/MemState" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    scream4ik/MemState
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core concept
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/integrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/langgraph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LangGraph
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    MemState
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    MemState
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AsyncMemoryStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AsyncMemoryStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.add_hook" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_hook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" add_hook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.add_hook(hook)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;hook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;commit
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" commit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit(fact)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit(ephemeral)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ephemeral
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;commit_model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" commit_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(model)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(source)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;source
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(ephemeral)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ephemeral
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;delete
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" delete">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.delete(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.delete(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.delete(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.delete(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.discard_session" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;discard_session
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" discard_session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.discard_session(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.get(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.promote_session" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;promote_session
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" promote_session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.promote_session(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.promote_session(selector)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;selector
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.promote_session(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.promote_session(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.query" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;query
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.query(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.query(filters)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;filters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.query(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.register_schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;register_schema
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" register_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.register_schema(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.register_schema(model)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.register_schema(constraint)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;constraint
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;rollback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" rollback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.rollback(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.rollback(steps)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.search(query)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;query
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.search(limit)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;limit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.search(filters)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;filters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.search(score_threshold)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;score_threshold
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;update
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" update">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.update(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.update(patch)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;patch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.update(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.update(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memstate.storage.Constraint" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Constraint
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MemoryStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MemoryStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.add_hook" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_hook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" add_hook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.add_hook(hook)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;hook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;commit
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" commit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit(fact)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit(ephemeral)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ephemeral
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;commit_model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" commit_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(model)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(source)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;source
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(ephemeral)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ephemeral
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;delete
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" delete">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.delete(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.delete(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.delete(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.delete(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.discard_session" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;discard_session
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" discard_session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.discard_session(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.get(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.promote_session" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;promote_session
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" promote_session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.promote_session(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.promote_session(selector)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;selector
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.promote_session(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.promote_session(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.query" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;query
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.query(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.query(filters)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;filters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.query(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.register_schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;register_schema
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" register_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.register_schema(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.register_schema(model)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.register_schema(constraint)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;constraint
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;rollback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" rollback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.rollback(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.rollback(steps)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.search(query)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;query
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.search(limit)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;limit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.search(filters)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;filters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.search(score_threshold)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;score_threshold
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;update
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" update">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.update(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.update(patch)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;patch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.update(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.update(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SchemaRegistry
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SchemaRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.get_type_by_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_type_by_model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get_type_by_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.get_type_by_model(model_class)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model_class
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.register" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;register
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" register">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.register(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.register(model)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.validate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;validate
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" validate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.validate(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.validate(payload)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;payload
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AsyncMemoryStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AsyncMemoryStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.add_hook" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_hook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" add_hook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.add_hook(hook)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;hook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;commit
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" commit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit(fact)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit(ephemeral)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ephemeral
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;commit_model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" commit_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(model)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(source)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;source
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(ephemeral)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ephemeral
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.commit_model(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;delete
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" delete">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.delete(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.delete(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.delete(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.delete(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.discard_session" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;discard_session
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" discard_session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.discard_session(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.get(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.promote_session" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;promote_session
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" promote_session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.promote_session(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.promote_session(selector)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;selector
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.promote_session(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.promote_session(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.query" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;query
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.query(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.query(filters)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;filters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.query(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.register_schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;register_schema
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" register_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.register_schema(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.register_schema(model)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.register_schema(constraint)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;constraint
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;rollback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" rollback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.rollback(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.rollback(steps)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.search(query)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;query
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.search(limit)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;limit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.search(filters)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;filters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.search(score_threshold)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;score_threshold
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;update
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" update">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.update(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.update(patch)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;patch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.update(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.AsyncMemoryStore.update(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memstate.storage.Constraint" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Constraint
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MemoryStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MemoryStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.add_hook" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_hook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" add_hook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.add_hook(hook)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;hook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;commit
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" commit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit(fact)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit(ephemeral)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ephemeral
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;commit_model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" commit_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(model)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(source)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;source
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(ephemeral)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ephemeral
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.commit_model(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;delete
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" delete">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.delete(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.delete(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.delete(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.delete(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.discard_session" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;discard_session
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" discard_session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.discard_session(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.get(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.promote_session" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;promote_session
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" promote_session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.promote_session(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.promote_session(selector)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;selector
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.promote_session(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.promote_session(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.query" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;query
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.query(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.query(filters)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;filters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.query(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.register_schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;register_schema
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" register_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.register_schema(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.register_schema(model)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.register_schema(constraint)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;constraint
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;rollback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" rollback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.rollback(session_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;session_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.rollback(steps)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.search(query)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;query
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.search(limit)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;limit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.search(filters)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;filters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.search(score_threshold)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;score_threshold
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;update
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" update">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.update(fact_id)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;fact_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.update(patch)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;patch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.update(actor)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;actor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.MemoryStore.update(reason)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SchemaRegistry
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SchemaRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.get_type_by_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_type_by_model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get_type_by_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.get_type_by_model(model_class)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model_class
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.register" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;register
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" register">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.register(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.register(model)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.validate" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;validate
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" validate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.validate(typename)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;typename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memstate.storage.SchemaRegistry.validate(payload)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;payload
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<div class="doc doc-object doc-module">



<h1 id="memstate.storage" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">storage</span>


</h1>

    <div class="doc doc-contents first">

          









<p><span class="doc-section-title">Classes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;AsyncMemoryStore&lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore">AsyncMemoryStore</a></code></b>
          –
          <div class="doc-md-description">
            <p>Handles in-memory storage of structured data with schema enforcement, transactional</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Constraint&lt;/span&gt; (&lt;code&gt;memstate.storage.Constraint&lt;/code&gt;)" href="#memstate.storage.Constraint">Constraint</a></code></b>
          –
          <div class="doc-md-description">
            <p>Represents a constraint with properties for configuration.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;MemoryStore&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore&lt;/code&gt;)" href="#memstate.storage.MemoryStore">MemoryStore</a></code></b>
          –
          <div class="doc-md-description">
            <p>Handles in-memory storage of structured data with schema enforcement, transactional</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;SchemaRegistry&lt;/span&gt; (&lt;code&gt;memstate.storage.SchemaRegistry&lt;/code&gt;)" href="#memstate.storage.SchemaRegistry">SchemaRegistry</a></code></b>
          –
          <div class="doc-md-description">
            <p>Manages schema registration and validation with a mapping of type names to Pydantic models.</p>
          </div>
        </li>
    </ul>







<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="memstate.storage.AsyncMemoryStore" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AsyncMemoryStore</span>


</h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">AsyncMemoryStore</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><span title="memstate.storage.AsyncMemoryStore(storage)">storage</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;AsyncStorageBackend&lt;/span&gt; (&lt;code&gt;memstate.backends.base.AsyncStorageBackend&lt;/code&gt;)" href="../backends/#memstate.backends.base.AsyncStorageBackend">AsyncStorageBackend</a></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><span title="memstate.storage.AsyncMemoryStore(hooks)">hooks</span></span><span class="p">:</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="memstate.types.AsyncMemoryHook">AsyncMemoryHook</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



        <p>Handles in-memory storage of structured data with schema enforcement, transactional
capabilities, and hooks for custom operations.</p>
<p>This class provides a structured method to store and retrieve facts with enforced schema
validation and constraints. It also supports mechanisms for transactional logging,
model validation, and hook execution during operations.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><span title="memstate.storage.AsyncMemoryStore.storage">storage</span></code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;AsyncStorageBackend&lt;/span&gt; (&lt;code&gt;memstate.backends.base.AsyncStorageBackend&lt;/code&gt;)" href="../backends/#memstate.backends.base.AsyncStorageBackend">AsyncStorageBackend</a></code>)
          –
          <div class="doc-md-description">
            <p>Backend storage mechanism for persisting facts and transaction information.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><span title="memstate.storage.AsyncMemoryStore.hooks">hooks</span></code></b>
              (<code><span title="list">list</span>[<span title="memstate.types.AsyncMemoryHook">AsyncMemoryHook</span>]</code>)
          –
          <div class="doc-md-description">
            <p>List of hooks to be executed during memory operations.</p>
          </div>
        </li>
    </ul>

          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Used by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>API Reference</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../integrations/#memstate.integrations"><code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;integrations</a>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../integrations/#memstate.integrations.langgraph"><code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;langgraph</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../integrations/#memstate.integrations.langgraph.AsyncMemStateCheckpointer"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AsyncMemStateCheckpointer</a>
  </span>

      </li>
  </ul>

  </div>












<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;add_hook&lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.add_hook&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.add_hook">add_hook</a></code></b>
            –
            <div class="doc-md-description">
              <p>Adds a new memory hook to the list of hooks.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;commit&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit">commit</a></code></b>
            –
            <div class="doc-md-description">
              <p>Asynchronously commits a <code>Fact</code> object to the storage, optionally allowing for ephemeral</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;commit_model&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit_model&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit_model">commit_model</a></code></b>
            –
            <div class="doc-md-description">
              <p>Asynchronously commits a model to the store using the provided schema registry and additional metadata.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;delete&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.delete&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.delete">delete</a></code></b>
            –
            <div class="doc-md-description">
              <p>Asynchronously deletes an existing fact from storage identified by the given fact ID. This operation logs the</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;discard_session&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.discard_session&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.discard_session">discard_session</a></code></b>
            –
            <div class="doc-md-description">
              <p>Asynchronously discard a session and clear related stored data in the storage.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;get&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.get&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.get">get</a></code></b>
            –
            <div class="doc-md-description">
              <p>Asynchronously retrieves a fact from the storage based on the provided fact ID.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;promote_session&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.promote_session&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.promote_session">promote_session</a></code></b>
            –
            <div class="doc-md-description">
              <p>Asynchronously promotes session-related facts by modifying the session ID to dissociate</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;query&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.query&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.query">query</a></code></b>
            –
            <div class="doc-md-description">
              <p>Asynchronously executes a query against the storage with optional type and filter constraints.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;register_schema&lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.register_schema&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.register_schema">register_schema</a></code></b>
            –
            <div class="doc-md-description">
              <p>Registers a schema in the schema registry and optionally applies a constraint.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;rollback&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.rollback&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.rollback">rollback</a></code></b>
            –
            <div class="doc-md-description">
              <p>Asynchronously reverts the state of the storage by rolling back a specified number of transactional</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;search&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.search&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.search">search</a></code></b>
            –
            <div class="doc-md-description">
              <p>Asynchronously performs a hybrid search operation combining semantic search through Vector DB</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;update&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-async&quot;&gt;&lt;code&gt;async&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.update&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.update">update</a></code></b>
            –
            <div class="doc-md-description">
              <p>Asynchronously updates an existing fact in the store by applying a patch to its contents. The update process</p>
            </div>
          </li>
    </ul>



                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>memstate/storage.py</code></summary>
                    <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">:</span> <span class="n">AsyncStorageBackend</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AsyncMemoryHook</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_schema_registry</span> <span class="o">=</span> <span class="n">SchemaRegistry</span><span class="p">()</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_seq</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AsyncMemoryHook</span><span class="p">]</span> <span class="o">=</span> <span class="n">hooks</span> <span class="ow">or</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.add_hook" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_hook</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">add_hook</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;hook&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.add_hook(hook)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.add_hook(hook)">hook</a></span><span class="p">:</span> <span class="n"><span title="memstate.types.AsyncMemoryHook">AsyncMemoryHook</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Adds a new memory hook to the list of hooks.</p>
<p>This method registers a <code>AsyncMemoryHook</code> instance into the internal hooks
list for further processing. A <code>AsyncMemoryHook</code> is an abstraction that can
be used to monitor and react to specific memory-related events.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.add_hook(hook)" class="doc doc-heading doc-heading-parameter">              <b><code>hook</code></b>
</h4>              (<code><span title="memstate.types.AsyncMemoryHook">AsyncMemoryHook</span></code>)
          –
          <div class="doc-md-description">
            <p>The hook instance to be added to the hooks list.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>None</code>
          –
          <div class="doc-md-description">
            <p>None</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AsyncMemoryHook</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">    Adds a new memory hook to the list of hooks.</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">    This method registers a `AsyncMemoryHook` instance into the internal hooks</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">    list for further processing. A `AsyncMemoryHook` is an abstraction that can</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">    be used to monitor and react to specific memory-related events.</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">        hook (AsyncMemoryHook): The hook instance to be added to the hooks list.</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">        None</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.commit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">commit</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">commit</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;fact&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit(fact)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit(fact)">fact</a></span><span class="p">:</span> <span class="n"><span title="memstate.schemas.Fact">Fact</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit(session_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;ephemeral&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit(ephemeral)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit(ephemeral)">ephemeral</a></span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;actor&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit(actor)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit(actor)">actor</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;reason&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit(reason)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit(reason)">reason</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Asynchronously commits a <code>Fact</code> object to the storage, optionally allowing for ephemeral
storage, and updates existing records if applicable. The operation evaluates
constraints such as immutability or uniqueness, handles potential duplicates,
and invokes hooks for logging and notifications. Supports rollback of changes
in case of errors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit(fact)" class="doc doc-heading doc-heading-parameter">              <b><code>fact</code></b>
</h4>              (<code><span title="memstate.schemas.Fact">Fact</span></code>)
          –
          <div class="doc-md-description">
            <p>The <code>Fact</code> object to be committed. Validates the payload against
schema registry and potentially updates or creates a new entry in the
storage.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional session identifier associated with the <code>Fact</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit(ephemeral)" class="doc doc-heading doc-heading-parameter">              <b><code>ephemeral</code></b>
</h4>              (<code><span title="bool">bool</span></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>Indicates whether the <code>Fact</code> is transient and should not be persisted. Defaults to <code>False</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit(actor)" class="doc doc-heading doc-heading-parameter">              <b><code>actor</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the individual or system responsible
for initiating the commit. Used for logging and auditing purposes.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit(reason)" class="doc doc-heading doc-heading-parameter">              <b><code>reason</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional string describing the purpose of the commit. Used
primarily for auditing and logging.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="str">str</span></code>
          –
          <div class="doc-md-description">
            <p>The unique identifier of the committed fact.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.HookError">HookError</span></code>
            –
          <div class="doc-md-description">
            <p>If an error occurs during hook execution.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">commit</span><span class="p">(</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>    <span class="n">fact</span><span class="p">:</span> <span class="n">Fact</span><span class="p">,</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>    <span class="n">ephemeral</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>    <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">    Asynchronously commits a `Fact` object to the storage, optionally allowing for ephemeral</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="sd">    storage, and updates existing records if applicable. The operation evaluates</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">    constraints such as immutability or uniqueness, handles potential duplicates,</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a><span class="sd">    and invokes hooks for logging and notifications. Supports rollback of changes</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="sd">    in case of errors.</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="sd">        fact (Fact): The `Fact` object to be committed. Validates the payload against</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">            schema registry and potentially updates or creates a new entry in the</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">            storage.</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">        session_id (str | None): Optional session identifier associated with the `Fact`.</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">        ephemeral (bool): Indicates whether the `Fact` is transient and should not be persisted. Defaults to `False`.</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">        actor (str | None): Optional identifier for the individual or system responsible</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">            for initiating the commit. Used for logging and auditing purposes.</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">        reason (str | None): Optional string describing the purpose of the commit. Used</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">            primarily for auditing and logging.</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">        The unique identifier of the committed fact.</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">        HookError: If an error occurs during hook execution.</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>    <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="n">validated_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_registry</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">fact</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">fact</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>        <span class="n">fact</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="n">validated_payload</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>        <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>            <span class="n">fact</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">session_id</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>        <span class="n">previous_state</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">COMMIT</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="n">constraint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fact</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>        <span class="k">if</span> <span class="n">constraint</span> <span class="ow">and</span> <span class="n">constraint</span><span class="o">.</span><span class="n">singleton_key</span><span class="p">:</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>            <span class="n">key_val</span> <span class="o">=</span> <span class="n">validated_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">singleton_key</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>            <span class="k">if</span> <span class="n">key_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>                <span class="n">search_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;payload.</span><span class="si">{</span><span class="n">constraint</span><span class="o">.</span><span class="n">singleton_key</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>                <span class="n">matches</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">type_filter</span><span class="o">=</span><span class="n">fact</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">json_filters</span><span class="o">=</span><span class="p">{</span><span class="n">search_key</span><span class="p">:</span> <span class="n">key_val</span><span class="p">})</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>                <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                    <span class="n">existing_raw</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>                    <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">immutable</span><span class="p">:</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                        <span class="k">raise</span> <span class="n">ConflictError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Immutable constraint violation: </span><span class="si">{</span><span class="n">fact</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">key_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>                    <span class="c1"># We found a duplicate, so this is an UPDATE of an existing one</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>                    <span class="n">previous_state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">existing_raw</span><span class="p">)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                    <span class="n">fact</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">existing_raw</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>  <span class="c1"># We replace the ID of the new fact with the old one</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>                    <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="k">if</span> <span class="n">op</span> <span class="o">!=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">:</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>            <span class="n">existing</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fact</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                <span class="n">previous_state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>                <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>                <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">COMMIT_EPHEMERAL</span> <span class="k">if</span> <span class="n">ephemeral</span> <span class="k">else</span> <span class="n">Operation</span><span class="o">.</span><span class="n">COMMIT</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>            <span class="n">new_state</span> <span class="o">=</span> <span class="n">fact</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_state</span><span class="p">)</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_tx</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">fact</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="n">fact</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">previous_state</span><span class="p">,</span> <span class="n">new_state</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">fact</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">fact</span><span class="p">)</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>            <span class="k">return</span> <span class="n">fact</span><span class="o">.</span><span class="n">id</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>        <span class="k">except</span> <span class="n">HookError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span> <span class="ow">and</span> <span class="n">previous_state</span><span class="p">:</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">previous_state</span><span class="p">)</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fact</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.commit_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">commit_model</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">commit_model</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;model&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit_model(model)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit_model(model)">model</a></span><span class="p">:</span> <span class="n"><span title="pydantic.BaseModel">BaseModel</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;fact_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit_model(fact_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit_model(fact_id)">fact_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;source&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit_model(source)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit_model(source)">source</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit_model(session_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit_model(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;ephemeral&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit_model(ephemeral)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit_model(ephemeral)">ephemeral</a></span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;actor&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit_model(actor)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit_model(actor)">actor</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;reason&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.commit_model(reason)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.commit_model(reason)">reason</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Asynchronously commits a model to the store using the provided schema registry and additional metadata.</p>
<p>This method registers a given <code>model</code> object with a schema type derived from its class. Metadata such
as <code>fact_id</code>, <code>source</code>, <code>session_id</code>, <code>ephemeral</code>, <code>actor</code>, and <code>reason</code> can be supplied to categorize
or provide context for the operation. If the model's schema type is not registered, an error is raised.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit_model(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
</h4>              (<code><span title="pydantic.BaseModel">BaseModel</span></code>)
          –
          <div class="doc-md-description">
            <p>The model instance to commit.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit_model(fact_id)" class="doc doc-heading doc-heading-parameter">              <b><code>fact_id</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional unique identifier for the fact. If not provided, a new UUID is generated.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit_model(source)" class="doc doc-heading doc-heading-parameter">              <b><code>source</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional source of the operation. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit_model(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the session in which the commit is performed. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit_model(ephemeral)" class="doc doc-heading doc-heading-parameter">              <b><code>ephemeral</code></b>
</h4>              (<code><span title="bool">bool</span></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>Optional. Determines if the data should be treated as ephemeral. Defaults to False.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit_model(actor)" class="doc doc-heading doc-heading-parameter">              <b><code>actor</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the entity performing the commit. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.commit_model(reason)" class="doc doc-heading doc-heading-parameter">              <b><code>reason</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional description or justification for the commit operation. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="str">str</span></code>
          –
          <div class="doc-md-description">
            <p>The result of the commit operation as a string.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.MemoryStoreError">MemoryStoreError</span></code>
            –
          <div class="doc-md-description">
            <p>If the model's schema type is not registered.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.HookError">HookError</span></code>
            –
          <div class="doc-md-description">
            <p>If an error occurs during hook execution.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-835" name="__codelineno-0-835"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">commit_model</span><span class="p">(</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">,</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>    <span class="n">fact_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>    <span class="n">ephemeral</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>    <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="sd">    Asynchronously commits a model to the store using the provided schema registry and additional metadata.</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">    This method registers a given `model` object with a schema type derived from its class. Metadata such</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="sd">    as `fact_id`, `source`, `session_id`, `ephemeral`, `actor`, and `reason` can be supplied to categorize</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="sd">    or provide context for the operation. If the model&#39;s schema type is not registered, an error is raised.</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">        model (BaseModel): The model instance to commit.</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">        fact_id (str | None): Optional unique identifier for the fact. If not provided, a new UUID is generated.</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="sd">        source (str | None): Optional source of the operation. Defaults to None.</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">        session_id (str | None): Optional identifier for the session in which the commit is performed. Defaults to None.</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">        ephemeral (bool): Optional. Determines if the data should be treated as ephemeral. Defaults to False.</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">        actor (str | None): Optional identifier for the entity performing the commit. Defaults to None.</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a><span class="sd">        reason (str | None): Optional description or justification for the commit operation. Defaults to None.</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a><span class="sd">        The result of the commit operation as a string.</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a><span class="sd">        MemoryStoreError: If the model&#39;s schema type is not registered.</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="sd">        HookError: If an error occurs during hook execution.</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>    <span class="n">schema_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_registry</span><span class="o">.</span><span class="n">get_type_by_model</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">schema_type</span><span class="p">:</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>        <span class="k">raise</span> <span class="n">MemoryStoreError</span><span class="p">(</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="sa">f</span><span class="s2">&quot;Model class &#39;</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; is not registered. &quot;</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="sa">f</span><span class="s2">&quot;Please call memory.register_schema(&#39;your_type_name&#39;, </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">) first.&quot;</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>        <span class="p">)</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>    <span class="n">fact</span> <span class="o">=</span> <span class="n">Fact</span><span class="p">(</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>        <span class="nb">id</span><span class="o">=</span><span class="n">fact_id</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span> <span class="nb">type</span><span class="o">=</span><span class="n">schema_type</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>    <span class="p">)</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">fact</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span> <span class="n">ephemeral</span><span class="o">=</span><span class="n">ephemeral</span><span class="p">,</span> <span class="n">actor</span><span class="o">=</span><span class="n">actor</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="n">reason</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.delete" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">delete</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">delete</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.delete(session_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.delete(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;fact_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.delete(fact_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.delete(fact_id)">fact_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;actor&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.delete(actor)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.delete(actor)">actor</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;reason&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.delete(reason)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.delete(reason)">reason</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Asynchronously deletes an existing fact from storage identified by the given fact ID. This operation logs the
deletion, notifies hooks about the operation, and ensures thread safety during execution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.delete(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span> | None</code>)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the session associated with the deletion operation. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.delete(fact_id)" class="doc doc-heading doc-heading-parameter">              <b><code>fact_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the fact to be deleted.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.delete(actor)" class="doc doc-heading doc-heading-parameter">              <b><code>actor</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the user or system performing the deletion. Defaults to None if not applicable.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.delete(reason)" class="doc doc-heading doc-heading-parameter">              <b><code>reason</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional reason or context for the deletion operation. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="str">str</span></code>
          –
          <div class="doc-md-description">
            <p>The fact ID of the deleted fact.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.MemoryStoreError">MemoryStoreError</span></code>
            –
          <div class="doc-md-description">
            <p>If the fact with the given ID is not found in storage.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="sd">    Asynchronously deletes an existing fact from storage identified by the given fact ID. This operation logs the</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="sd">    deletion, notifies hooks about the operation, and ensures thread safety during execution.</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">        session_id (str | None): Optional identifier for the session associated with the deletion operation. Defaults to None.</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">        fact_id (str): The unique identifier of the fact to be deleted.</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">        actor (str | None): Optional identifier for the user or system performing the deletion. Defaults to None if not applicable.</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">        reason (str | None): Optional reason or context for the deletion operation. Defaults to None.</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">        The fact ID of the deleted fact.</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="sd">        MemoryStoreError: If the fact with the given ID is not found in storage.</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>    <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>        <span class="n">existing</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fact_id</span><span class="p">)</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>            <span class="k">raise</span> <span class="n">MemoryStoreError</span><span class="p">(</span><span class="s2">&quot;Fact not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fact_id</span><span class="p">)</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_tx</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">,</span> <span class="n">existing</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">,</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">existing</span><span class="p">))</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>        <span class="k">return</span> <span class="n">fact_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.discard_session" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">discard_session</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">discard_session</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.discard_session(session_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.discard_session(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="int">int</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Asynchronously discard a session and clear related stored data in the storage.</p>
<p>This method removes all records associated with the given session ID
from the storage and logs the operation if any data is cleared.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.discard_session(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the session to discard.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="int">int</span></code>
          –
          <div class="doc-md-description">
            <p>The number of records cleared from the storage.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">discard_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="sd">    Asynchronously discard a session and clear related stored data in the storage.</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">    This method removes all records associated with the given session ID</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">    from the storage and logs the operation if any data is cleared.</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">        session_id (str): The unique identifier of the session to discard.</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">        The number of records cleared from the storage.</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>    <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>        <span class="n">deleted_ids</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>        <span class="k">if</span> <span class="n">deleted_ids</span><span class="p">:</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_tx</span><span class="p">(</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>                <span class="n">Operation</span><span class="o">.</span><span class="n">DISCARD_SESSION</span><span class="p">,</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>                <span class="n">session_id</span><span class="p">,</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>                <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>                <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>                <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>                <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>                <span class="sa">f</span><span class="s2">&quot;Session </span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2"> cleared (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deleted_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> facts)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>            <span class="p">)</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>            <span class="n">dummy</span> <span class="o">=</span> <span class="n">Fact</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{},</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">DISCARD_SESSION</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dummy</span><span class="p">)</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">deleted_ids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.get" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;fact_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.get(fact_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.get(fact_id)">fact_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Asynchronously retrieves a fact from the storage based on the provided fact ID.</p>
<p>This method accesses the underlying storage to load a fact corresponding
to the given identifier. If the fact ID does not exist in the storage,
the method will return None.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.get(fact_id)" class="doc doc-heading doc-heading-parameter">              <b><code>fact_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the fact to retrieve.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
          –
          <div class="doc-md-description">
            <p>A dictionary representation of the fact if found, otherwise None.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">    Asynchronously retrieves a fact from the storage based on the provided fact ID.</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="sd">    This method accesses the underlying storage to load a fact corresponding</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">    to the given identifier. If the fact ID does not exist in the storage,</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">    the method will return None.</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">        fact_id (str): The unique identifier of the fact to retrieve.</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="sd">        A dictionary representation of the fact if found, otherwise None.</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fact_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.promote_session" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">promote_session</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote_session</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.promote_session(session_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.promote_session(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;selector&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.promote_session(selector)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.promote_session(selector)">selector</a></span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        <span class="n"><span title="typing.Callable">Callable</span></span><span class="p">[[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]],</span> <span class="n"><span title="bool">bool</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;actor&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.promote_session(actor)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.promote_session(actor)">actor</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;reason&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.promote_session(reason)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.promote_session(reason)">reason</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Asynchronously promotes session-related facts by modifying the session ID to dissociate
them from the provided session. This is based on the selector criteria
(if provided). The promotion operation will be logged and associated hooks
will be notified.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.promote_session(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the session whose facts are to be processed for promotion.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.promote_session(selector)" class="doc doc-heading doc-heading-parameter">              <b><code>selector</code></b>
</h4>              (<code><span title="typing.Callable">Callable</span>[[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]], <span title="bool">bool</span>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A callable to filter facts based on custom logic. If
provided, only facts passing this filter will be promoted. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.promote_session(actor)" class="doc doc-heading doc-heading-parameter">              <b><code>actor</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the user or system performing the promotion operation. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.promote_session(reason)" class="doc doc-heading doc-heading-parameter">              <b><code>reason</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional reason or context for the promotion operation. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="list">list</span>[<span title="str">str</span>]</code>
          –
          <div class="doc-md-description">
            <p>A list of identifiers for the promoted facts.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">promote_session</span><span class="p">(</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>    <span class="n">selector</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>    <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="sd">    Asynchronously promotes session-related facts by modifying the session ID to dissociate</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><span class="sd">    them from the provided session. This is based on the selector criteria</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="sd">    (if provided). The promotion operation will be logged and associated hooks</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="sd">    will be notified.</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a><span class="sd">        session_id (str): The unique identifier of the session whose facts are to be processed for promotion.</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><span class="sd">        selector (Callable[[dict[str, Any]], bool] | None): A callable to filter facts based on custom logic. If</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><span class="sd">            provided, only facts passing this filter will be promoted. Defaults to None.</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="sd">        actor (str | None): Optional identifier for the user or system performing the promotion operation. Defaults to None.</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="sd">        reason (str | None): Optional reason or context for the promotion operation. Defaults to None.</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a><span class="sd">        A list of identifiers for the promoted facts.</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>    <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="n">candidates</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get_session_facts</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="n">promoted</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>        <span class="k">for</span> <span class="n">fact_dict</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>            <span class="k">if</span> <span class="n">selector</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">selector</span><span class="p">(</span><span class="n">fact_dict</span><span class="p">):</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>            <span class="n">before</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fact_dict</span><span class="p">)</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>            <span class="n">fact_dict</span><span class="p">[</span><span class="s2">&quot;session_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fact_dict</span><span class="p">)</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>            <span class="n">promoted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fact_dict</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_tx</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">PROMOTE</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">fact_dict</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">before</span><span class="p">,</span> <span class="n">fact_dict</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">PROMOTE</span><span class="p">,</span> <span class="n">fact_dict</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">fact_dict</span><span class="p">))</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>        <span class="k">return</span> <span class="n">promoted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.query" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">query</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">query</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;typename&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.query(typename)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.query(typename)">typename</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;filters&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.query(filters)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.query(filters)">filters</a></span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.query(session_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.query(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Asynchronously executes a query against the storage with optional type and filter constraints.</p>
<p>This method interacts with the underlying storage to filter and retrieve data
based on the provided type and filtering criteria. The <code>typename</code> allows for
filtering objects of a specific type, whereas <code>filters</code> enables more fine-grained
queries by applying a JSON-based filter.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.query(typename)" class="doc doc-heading doc-heading-parameter">              <b><code>typename</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A string that specifies the type of objects to query. If set
to None, no type filtering is applied.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.query(filters)" class="doc doc-heading doc-heading-parameter">              <b><code>filters</code></b>
</h4>              (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A dictionary representing JSON-style filter constraints to
apply to the query. If set to None, no filter constraints are applied.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.query(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the session associated with the query. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
          –
          <div class="doc-md-description">
            <p>A list of dictionaries containing query results that match the given filters and type constraints.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="sd">    Asynchronously executes a query against the storage with optional type and filter constraints.</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="sd">    This method interacts with the underlying storage to filter and retrieve data</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">    based on the provided type and filtering criteria. The `typename` allows for</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="sd">    filtering objects of a specific type, whereas `filters` enables more fine-grained</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="sd">    queries by applying a JSON-based filter.</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">        typename (str | None): A string that specifies the type of objects to query. If set</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="sd">            to None, no type filtering is applied.</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">        filters (dict[str, Any] | None): A dictionary representing JSON-style filter constraints to</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="sd">            apply to the query. If set to None, no filter constraints are applied.</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">        session_id (str | None): Optional identifier for the session associated with the query. Defaults to None.</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">        A list of dictionaries containing query results that match the given filters and type constraints.</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>    <span class="n">final_filters</span> <span class="o">=</span> <span class="p">(</span><span class="n">filters</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>    <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>        <span class="n">final_filters</span><span class="p">[</span><span class="s2">&quot;session_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">type_filter</span><span class="o">=</span><span class="n">typename</span><span class="p">,</span> <span class="n">json_filters</span><span class="o">=</span><span class="n">final_filters</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.register_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">register_schema</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">register_schema</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;typename&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.register_schema(typename)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.register_schema(typename)">typename</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;model&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.register_schema(model)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.register_schema(model)">model</a></span><span class="p">:</span> <span class="n"><span title="type">type</span></span><span class="p">[</span><span class="n"><span title="pydantic.BaseModel">BaseModel</span></span><span class="p">],</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;constraint&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.register_schema(constraint)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.register_schema(constraint)">constraint</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Constraint&lt;/span&gt; (&lt;code&gt;memstate.storage.Constraint&lt;/code&gt;)" href="#memstate.storage.Constraint">Constraint</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Registers a schema in the schema registry and optionally applies a constraint.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.register_schema(typename)" class="doc doc-heading doc-heading-parameter">              <b><code>typename</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier for the model being registered.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.register_schema(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
</h4>              (<code><span title="type">type</span>[<span title="pydantic.BaseModel">BaseModel</span>]</code>)
          –
          <div class="doc-md-description">
            <p>The Pydantic model class to register.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.register_schema(constraint)" class="doc doc-heading doc-heading-parameter">              <b><code>constraint</code></b>
</h4>              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Constraint&lt;/span&gt; (&lt;code&gt;memstate.storage.Constraint&lt;/code&gt;)" href="#memstate.storage.Constraint">Constraint</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional constraint to associate with the type.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>None</code>
          –
          <div class="doc-md-description">
            <p>None</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="k">def</span><span class="w"> </span><span class="nf">register_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">],</span> <span class="n">constraint</span><span class="p">:</span> <span class="n">Constraint</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">    Registers a schema in the schema registry and optionally applies a constraint.</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">        typename (str): The unique identifier for the model being registered.</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">        model (type[BaseModel]): The Pydantic model class to register.</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">        constraint (Constraint | None): Optional constraint to associate with the type.</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">        None</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_schema_registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">typename</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>    <span class="k">if</span> <span class="n">constraint</span><span class="p">:</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="p">[</span><span class="n">typename</span><span class="p">]</span> <span class="o">=</span> <span class="n">constraint</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.rollback" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">rollback</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">rollback</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.rollback(session_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.rollback(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;steps&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.rollback(steps)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.rollback(steps)">steps</a></span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Asynchronously reverts the state of the storage by rolling back a specified number of transactional
operations. Each operation is extracted from the transaction log and reversed based on
its type (e.g., CREATE, UPDATE, DELETE).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.rollback(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the session to roll back.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.rollback(steps)" class="doc doc-heading doc-heading-parameter">              <b><code>steps</code></b>
</h4>              (<code><span title="int">int</span></code>, default:
                  <code>1</code>
)
          –
          <div class="doc-md-description">
            <p>The number of transactional steps to roll back. Defaults to 1. Must be a positive integer.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>None</code>
          –
          <div class="doc-md-description">
            <p>None</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">    Asynchronously reverts the state of the storage by rolling back a specified number of transactional</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a><span class="sd">    operations. Each operation is extracted from the transaction log and reversed based on</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">    its type (e.g., CREATE, UPDATE, DELETE).</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="sd">        session_id (str): The unique identifier of the session to roll back.</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="sd">        steps (int): The number of transactional steps to roll back. Defaults to 1. Must be a positive integer.</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">        None</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>    <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>        <span class="k">if</span> <span class="n">steps</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>            <span class="k">return</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>        <span class="n">logs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get_tx_log</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">steps</span><span class="p">)</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>            <span class="n">op</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;op&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>            <span class="n">fid</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>            <span class="k">if</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;COMMIT&quot;</span><span class="p">,</span> <span class="s2">&quot;COMMIT_EPHEMERAL&quot;</span><span class="p">,</span> <span class="s2">&quot;UPDATE&quot;</span><span class="p">,</span> <span class="s2">&quot;PROMOTE&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">,</span> <span class="n">fid</span><span class="p">,</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>                    <span class="k">if</span> <span class="n">fid</span><span class="p">:</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="n">fid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">COMMIT</span><span class="p">,</span> <span class="n">fid</span><span class="p">,</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>        <span class="n">tx_uuids</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;uuid&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">]</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete_txs</span><span class="p">(</span><span class="n">tx_uuids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.search" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">search</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">search</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;query&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.search(query)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.search(query)">query</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;limit&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.search(limit)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.search(limit)">limit</a></span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;filters&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.search(filters)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.search(filters)">filters</a></span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;score_threshold&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.search(score_threshold)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.search(score_threshold)">score_threshold</a></span><span class="p">:</span> <span class="n"><span title="float">float</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="memstate.schemas.ScoredFact">ScoredFact</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Asynchronously performs a hybrid search operation combining semantic search through Vector DB
with data retrieval from a storage system. This function enables the execution
of both fuzzy and precise search queries and supports filtering. The semantic
search retrieves relevant IDs and scores, while the storage system augments
these results with the most recent data associated with those IDs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.search(query)" class="doc doc-heading doc-heading-parameter">              <b><code>query</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The search term to use when querying both the vector database and the storage system.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.search(limit)" class="doc doc-heading doc-heading-parameter">              <b><code>limit</code></b>
</h4>              (<code><span title="int">int</span></code>, default:
                  <code>5</code>
)
          –
          <div class="doc-md-description">
            <p>The maximum number of results to return. Optional, with a default value of 5.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.search(filters)" class="doc doc-heading doc-heading-parameter">              <b><code>filters</code></b>
</h4>              (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A dictionary of filter conditions to apply during the search.
The filters argument supports simple key-value matching {"key": "value"} across all backends.
For complex queries (ranges, OR-logic), you must use the syntax specific to your active Vector DB.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.search(score_threshold)" class="doc doc-heading doc-heading-parameter">              <b><code>score_threshold</code></b>
</h4>              (<code><span title="float">float</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A numeric threshold to exclude results with scores
below this value. Optional, defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="list">list</span>[<span title="memstate.schemas.ScoredFact">ScoredFact</span>]</code>
          –
          <div class="doc-md-description">
            <p>A list of <code>ScoredFact</code> objects containing facts retrieved and their associated scores.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1115" name="__codelineno-0-1115"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredFact</span><span class="p">]:</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">    Asynchronously performs a hybrid search operation combining semantic search through Vector DB</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a><span class="sd">    with data retrieval from a storage system. This function enables the execution</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a><span class="sd">    of both fuzzy and precise search queries and supports filtering. The semantic</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a><span class="sd">    search retrieves relevant IDs and scores, while the storage system augments</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a><span class="sd">    these results with the most recent data associated with those IDs.</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><span class="sd">        query (str): The search term to use when querying both the vector database and the storage system.</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="sd">        limit (int): The maximum number of results to return. Optional, with a default value of 5.</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="sd">        filters (dict[str, Any] | None): A dictionary of filter conditions to apply during the search.</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a><span class="sd">            The filters argument supports simple key-value matching {&quot;key&quot;: &quot;value&quot;} across all backends.</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">            For complex queries (ranges, OR-logic), you must use the syntax specific to your active Vector DB.</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">        score_threshold (float | None): A numeric threshold to exclude results with scores</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">            below this value. Optional, defaults to None.</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">        A list of `ScoredFact` objects containing facts retrieved and their associated scores.</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>    <span class="n">search_results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SearchResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>    <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">:</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">hook</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">score_threshold</span><span class="p">)</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>        <span class="n">search_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">search_results</span><span class="p">:</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>    <span class="n">unique_hits</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">fact_id</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">score</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">search_results</span><span class="p">}</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>    <span class="n">final_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>    <span class="k">for</span> <span class="n">fid</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">unique_hits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>            <span class="n">fact</span> <span class="o">=</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>            <span class="n">final_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ScoredFact</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">fact</span><span class="o">=</span><span class="n">fact</span><span class="p">))</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>    <span class="k">return</span> <span class="n">final_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.AsyncMemoryStore.update" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">update</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">update</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;fact_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.update(fact_id)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.update(fact_id)">fact_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;patch&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.update(patch)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.update(patch)">patch</a></span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">],</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;actor&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.update(actor)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.update(actor)">actor</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;reason&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.AsyncMemoryStore.update(reason)&lt;/code&gt;)" href="#memstate.storage.AsyncMemoryStore.update(reason)">reason</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Asynchronously updates an existing fact in the store by applying a patch to its contents. The update process
validates the resulting payload using the schema registry and manages concurrent modifications
with locking. If the update fails during hook notification, the operation is rolled back
to its previous state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.update(fact_id)" class="doc doc-heading doc-heading-parameter">              <b><code>fact_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the fact to be updated.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.update(patch)" class="doc doc-heading doc-heading-parameter">              <b><code>patch</code></b>
</h4>              (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>)
          –
          <div class="doc-md-description">
            <p>A dictionary representing the modifications to be applied to the current fact's payload.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.update(actor)" class="doc doc-heading doc-heading-parameter">              <b><code>actor</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the user or system performing the update. Defaults to None if not applicable.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.AsyncMemoryStore.update(reason)" class="doc doc-heading doc-heading-parameter">              <b><code>reason</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional reason or context for the update operation. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="str">str</span></code>
          –
          <div class="doc-md-description">
            <p>The unique identifier of the updated fact.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.MemoryStoreError">MemoryStoreError</span></code>
            –
          <div class="doc-md-description">
            <p>If the fact with the specified identifier is not found in the store.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.HookError">HookError</span></code>
            –
          <div class="doc-md-description">
            <p>If an error occurs during the hook notification process.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">patch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a><span class="sd">    Asynchronously updates an existing fact in the store by applying a patch to its contents. The update process</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a><span class="sd">    validates the resulting payload using the schema registry and manages concurrent modifications</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">    with locking. If the update fails during hook notification, the operation is rolled back</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">    to its previous state.</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">        fact_id (str): The unique identifier of the fact to be updated.</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="sd">        patch (dict[str, Any]): A dictionary representing the modifications to be applied to the current fact&#39;s payload.</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">        actor (str | None): Optional identifier for the user or system performing the update. Defaults to None if not applicable.</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">        reason (str | None): Optional reason or context for the update operation. Defaults to None.</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">        The unique identifier of the updated fact.</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">        MemoryStoreError: If the fact with the specified identifier is not found in the store.</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">        HookError: If an error occurs during the hook notification process.</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>    <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>        <span class="n">existing</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fact_id</span><span class="p">)</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing</span><span class="p">:</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>            <span class="k">raise</span> <span class="n">MemoryStoreError</span><span class="p">(</span><span class="s2">&quot;Fact not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>        <span class="n">before</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>        <span class="n">draft</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>        <span class="n">current_payload</span> <span class="o">=</span> <span class="n">draft</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>        <span class="n">patch_payload</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>        <span class="n">current_payload</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">patch_payload</span><span class="p">)</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>        <span class="n">fact_type</span> <span class="o">=</span> <span class="n">draft</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>        <span class="n">validated_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_registry</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">fact_type</span><span class="p">,</span> <span class="n">current_payload</span><span class="p">)</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>        <span class="n">draft</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">validated_payload</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>        <span class="n">draft</span><span class="p">[</span><span class="s2">&quot;ts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">draft</span><span class="p">)</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_tx</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">,</span> <span class="n">draft</span><span class="p">[</span><span class="s2">&quot;session_id&quot;</span><span class="p">],</span> <span class="n">fact_id</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">draft</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">,</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">draft</span><span class="p">))</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>        <span class="k">except</span> <span class="n">HookError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>        <span class="k">return</span> <span class="n">fact_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memstate.storage.Constraint" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">Constraint</span>


</h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">Constraint</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><span title="memstate.storage.Constraint(singleton_key)">singleton_key</span></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><span title="memstate.storage.Constraint(immutable)">immutable</span></span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



        <p>Represents a constraint with properties for configuration.</p>
<p>This class is used to define constraints with options for a singleton
key and immutability. It provides a structure to manage these constraint
properties for further processing or validation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><span title="memstate.storage.Constraint.singleton_key">singleton_key</span></code></b>
              (<code><span title="str">str</span> | None</code>)
          –
          <div class="doc-md-description">
            <p>Optional key used to identify a singleton behavior.
If set, it implies uniqueness based on the value of the key.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><span title="memstate.storage.Constraint.immutable">immutable</span></code></b>
              (<code><span title="bool">bool</span></code>)
          –
          <div class="doc-md-description">
            <p>Indicates if the constraint is immutable. If True, the
constraint cannot be modified after its creation.</p>
          </div>
        </li>
    </ul>

          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Used by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>API Reference</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="#memstate.storage"><code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;storage</a>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="#memstate.storage.AsyncMemoryStore"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AsyncMemoryStore</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="#memstate.storage.AsyncMemoryStore.register_schema"><code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;register_schema</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="#memstate.storage.MemoryStore"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MemoryStore</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="#memstate.storage.MemoryStore.register_schema"><code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;register_schema</a>
  </span>

      </li>
  </ul>

      </li>
  </ul>

  </div>













                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>memstate/storage.py</code></summary>
                    <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">singleton_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">immutable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">singleton_key</span> <span class="o">=</span> <span class="n">singleton_key</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">immutable</span> <span class="o">=</span> <span class="n">immutable</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memstate.storage.MemoryStore" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">MemoryStore</span>


</h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">MemoryStore</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><span title="memstate.storage.MemoryStore(storage)">storage</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;StorageBackend&lt;/span&gt; (&lt;code&gt;memstate.backends.base.StorageBackend&lt;/code&gt;)" href="../backends/#memstate.backends.base.StorageBackend">StorageBackend</a></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><span title="memstate.storage.MemoryStore(hooks)">hooks</span></span><span class="p">:</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="memstate.types.MemoryHook">MemoryHook</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



        <p>Handles in-memory storage of structured data with schema enforcement, transactional
capabilities, and hooks for custom operations.</p>
<p>This class provides a structured method to store and retrieve facts with enforced schema
validation and constraints. It also supports mechanisms for transactional logging,
model validation, and hook execution during operations.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><span title="memstate.storage.MemoryStore.storage">storage</span></code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;StorageBackend&lt;/span&gt; (&lt;code&gt;memstate.backends.base.StorageBackend&lt;/code&gt;)" href="../backends/#memstate.backends.base.StorageBackend">StorageBackend</a></code>)
          –
          <div class="doc-md-description">
            <p>Backend storage mechanism for persisting facts and transaction information.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><span title="memstate.storage.MemoryStore.hooks">hooks</span></code></b>
              (<code><span title="list">list</span>[<span title="memstate.types.MemoryHook">MemoryHook</span>]</code>)
          –
          <div class="doc-md-description">
            <p>List of hooks to be executed during memory operations.</p>
          </div>
        </li>
    </ul>

          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Used by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>API Reference</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../integrations/#memstate.integrations"><code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;integrations</a>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../integrations/#memstate.integrations.langgraph"><code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;langgraph</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../integrations/#memstate.integrations.langgraph.MemStateCheckpointer"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MemStateCheckpointer</a>
  </span>

      </li>
  </ul>

  </div>












<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;add_hook&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.add_hook&lt;/code&gt;)" href="#memstate.storage.MemoryStore.add_hook">add_hook</a></code></b>
            –
            <div class="doc-md-description">
              <p>Adds a new memory hook to the list of hooks.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;commit&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit">commit</a></code></b>
            –
            <div class="doc-md-description">
              <p>Commits a <code>Fact</code> object to the storage, optionally allowing for ephemeral</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;commit_model&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit_model&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit_model">commit_model</a></code></b>
            –
            <div class="doc-md-description">
              <p>Commits a model to the store using the provided schema registry and additional metadata.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;delete&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.delete&lt;/code&gt;)" href="#memstate.storage.MemoryStore.delete">delete</a></code></b>
            –
            <div class="doc-md-description">
              <p>Deletes an existing fact from storage identified by the given fact ID. This operation logs the</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;discard_session&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.discard_session&lt;/code&gt;)" href="#memstate.storage.MemoryStore.discard_session">discard_session</a></code></b>
            –
            <div class="doc-md-description">
              <p>Discard a session and clear related stored data in the storage.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;get&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.get&lt;/code&gt;)" href="#memstate.storage.MemoryStore.get">get</a></code></b>
            –
            <div class="doc-md-description">
              <p>Retrieves a fact from the storage based on the provided fact ID.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;promote_session&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.promote_session&lt;/code&gt;)" href="#memstate.storage.MemoryStore.promote_session">promote_session</a></code></b>
            –
            <div class="doc-md-description">
              <p>Promotes session-related facts by modifying the session ID to dissociate</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;query&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.query&lt;/code&gt;)" href="#memstate.storage.MemoryStore.query">query</a></code></b>
            –
            <div class="doc-md-description">
              <p>Executes a query against the storage with optional type and filter constraints.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;register_schema&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.register_schema&lt;/code&gt;)" href="#memstate.storage.MemoryStore.register_schema">register_schema</a></code></b>
            –
            <div class="doc-md-description">
              <p>Registers a schema in the schema registry and optionally applies a constraint.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;rollback&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.rollback&lt;/code&gt;)" href="#memstate.storage.MemoryStore.rollback">rollback</a></code></b>
            –
            <div class="doc-md-description">
              <p>Reverts the state of the storage by rolling back a specified number of transactional</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;search&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.search&lt;/code&gt;)" href="#memstate.storage.MemoryStore.search">search</a></code></b>
            –
            <div class="doc-md-description">
              <p>Performs a hybrid search operation combining semantic search through Vector DB</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;update&lt;/span&gt; (&lt;code&gt;memstate.storage.MemoryStore.update&lt;/code&gt;)" href="#memstate.storage.MemoryStore.update">update</a></code></b>
            –
            <div class="doc-md-description">
              <p>Updates an existing fact in the store by applying a patch to its contents. The update process</p>
            </div>
          </li>
    </ul>



                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>memstate/storage.py</code></summary>
                    <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">:</span> <span class="n">StorageBackend</span><span class="p">,</span> <span class="n">hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MemoryHook</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_schema_registry</span> <span class="o">=</span> <span class="n">SchemaRegistry</span><span class="p">()</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_seq</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MemoryHook</span><span class="p">]</span> <span class="o">=</span> <span class="n">hooks</span> <span class="ow">or</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.add_hook" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_hook</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">add_hook</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;hook&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.add_hook(hook)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.add_hook(hook)">hook</a></span><span class="p">:</span> <span class="n"><span title="memstate.types.MemoryHook">MemoryHook</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Adds a new memory hook to the list of hooks.</p>
<p>This method registers a <code>MemoryHook</code> instance into the internal hooks
list for further processing. A <code>MemoryHook</code> is an abstraction that can
be used to monitor and react to specific memory-related events.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.add_hook(hook)" class="doc doc-heading doc-heading-parameter">              <b><code>hook</code></b>
</h4>              (<code><span title="memstate.types.MemoryHook">MemoryHook</span></code>)
          –
          <div class="doc-md-description">
            <p>The hook instance to be added to the hooks list.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>None</code>
          –
          <div class="doc-md-description">
            <p>None</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">MemoryHook</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    Adds a new memory hook to the list of hooks.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    This method registers a `MemoryHook` instance into the internal hooks</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    list for further processing. A `MemoryHook` is an abstraction that can</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    be used to monitor and react to specific memory-related events.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        hook (MemoryHook): The hook instance to be added to the hooks list.</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        None</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.commit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">commit</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">commit</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;fact&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit(fact)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit(fact)">fact</a></span><span class="p">:</span> <span class="n"><span title="memstate.schemas.Fact">Fact</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit(session_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;ephemeral&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit(ephemeral)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit(ephemeral)">ephemeral</a></span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;actor&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit(actor)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit(actor)">actor</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;reason&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit(reason)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit(reason)">reason</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Commits a <code>Fact</code> object to the storage, optionally allowing for ephemeral
storage, and updates existing records if applicable. The operation evaluates
constraints such as immutability or uniqueness, handles potential duplicates,
and invokes hooks for logging and notifications. Supports rollback of changes
in case of errors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit(fact)" class="doc doc-heading doc-heading-parameter">              <b><code>fact</code></b>
</h4>              (<code><span title="memstate.schemas.Fact">Fact</span></code>)
          –
          <div class="doc-md-description">
            <p>The <code>Fact</code> object to be committed. Validates the payload against
schema registry and potentially updates or creates a new entry in the
storage.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional session identifier associated with the <code>Fact</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit(ephemeral)" class="doc doc-heading doc-heading-parameter">              <b><code>ephemeral</code></b>
</h4>              (<code><span title="bool">bool</span></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>Indicates whether the <code>Fact</code> is transient and should not be persisted. Defaults to <code>False</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit(actor)" class="doc doc-heading doc-heading-parameter">              <b><code>actor</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the individual or system responsible
for initiating the commit. Used for logging and auditing purposes.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit(reason)" class="doc doc-heading doc-heading-parameter">              <b><code>reason</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional string describing the purpose of the commit. Used
primarily for auditing and logging.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="str">str</span></code>
          –
          <div class="doc-md-description">
            <p>The unique identifier of the committed fact.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.HookError">HookError</span></code>
            –
          <div class="doc-md-description">
            <p>If an error occurs during hook execution.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="k">def</span><span class="w"> </span><span class="nf">commit</span><span class="p">(</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="n">fact</span><span class="p">:</span> <span class="n">Fact</span><span class="p">,</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">ephemeral</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    Commits a `Fact` object to the storage, optionally allowing for ephemeral</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    storage, and updates existing records if applicable. The operation evaluates</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    constraints such as immutability or uniqueness, handles potential duplicates,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    and invokes hooks for logging and notifications. Supports rollback of changes</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    in case of errors.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        fact (Fact): The `Fact` object to be committed. Validates the payload against</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">            schema registry and potentially updates or creates a new entry in the</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">            storage.</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        session_id (str | None): Optional session identifier associated with the `Fact`.</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        ephemeral (bool): Indicates whether the `Fact` is transient and should not be persisted. Defaults to `False`.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        actor (str | None): Optional identifier for the individual or system responsible</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">            for initiating the commit. Used for logging and auditing purposes.</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        reason (str | None): Optional string describing the purpose of the commit. Used</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">            primarily for auditing and logging.</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">        The unique identifier of the committed fact.</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">        HookError: If an error occurs during hook execution.</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="n">validated_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_registry</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">fact</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">fact</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="n">fact</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="n">validated_payload</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="n">fact</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">session_id</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="n">previous_state</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">COMMIT</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="n">constraint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fact</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">if</span> <span class="n">constraint</span> <span class="ow">and</span> <span class="n">constraint</span><span class="o">.</span><span class="n">singleton_key</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="n">key_val</span> <span class="o">=</span> <span class="n">validated_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">singleton_key</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="k">if</span> <span class="n">key_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>                <span class="n">search_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;payload.</span><span class="si">{</span><span class="n">constraint</span><span class="o">.</span><span class="n">singleton_key</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">type_filter</span><span class="o">=</span><span class="n">fact</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">json_filters</span><span class="o">=</span><span class="p">{</span><span class="n">search_key</span><span class="p">:</span> <span class="n">key_val</span><span class="p">})</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                    <span class="n">existing_raw</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                    <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">immutable</span><span class="p">:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                        <span class="k">raise</span> <span class="n">ConflictError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Immutable constraint violation: </span><span class="si">{</span><span class="n">fact</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">key_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                    <span class="c1"># We found a duplicate, so this is an UPDATE of an existing one</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                    <span class="n">previous_state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">existing_raw</span><span class="p">)</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                    <span class="n">fact</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">existing_raw</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>  <span class="c1"># We replace the ID of the new fact with the old one</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                    <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="k">if</span> <span class="n">op</span> <span class="o">!=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fact</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                <span class="n">previous_state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="n">COMMIT_EPHEMERAL</span> <span class="k">if</span> <span class="n">ephemeral</span> <span class="k">else</span> <span class="n">Operation</span><span class="o">.</span><span class="n">COMMIT</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="n">new_state</span> <span class="o">=</span> <span class="n">fact</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_state</span><span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_log_tx</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">fact</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="n">fact</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">previous_state</span><span class="p">,</span> <span class="n">new_state</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">fact</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">fact</span><span class="p">)</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="k">return</span> <span class="n">fact</span><span class="o">.</span><span class="n">id</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="k">except</span> <span class="n">HookError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span> <span class="ow">and</span> <span class="n">previous_state</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">previous_state</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fact</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.commit_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">commit_model</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">commit_model</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;model&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit_model(model)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit_model(model)">model</a></span><span class="p">:</span> <span class="n"><span title="pydantic.BaseModel">BaseModel</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;fact_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit_model(fact_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit_model(fact_id)">fact_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;source&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit_model(source)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit_model(source)">source</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit_model(session_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit_model(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;ephemeral&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit_model(ephemeral)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit_model(ephemeral)">ephemeral</a></span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;actor&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit_model(actor)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit_model(actor)">actor</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;reason&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.commit_model(reason)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.commit_model(reason)">reason</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Commits a model to the store using the provided schema registry and additional metadata.</p>
<p>This method registers a given <code>model</code> object with a schema type derived from its class. Metadata such
as <code>fact_id</code>, <code>source</code>, <code>session_id</code>, <code>ephemeral</code>, <code>actor</code>, and <code>reason</code> can be supplied to categorize
or provide context for the operation. If the model's schema type is not registered, an error is raised.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit_model(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
</h4>              (<code><span title="pydantic.BaseModel">BaseModel</span></code>)
          –
          <div class="doc-md-description">
            <p>The model instance to commit.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit_model(fact_id)" class="doc doc-heading doc-heading-parameter">              <b><code>fact_id</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional unique identifier for the fact. If not provided, a new UUID is generated.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit_model(source)" class="doc doc-heading doc-heading-parameter">              <b><code>source</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional source of the operation. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit_model(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the session in which the commit is performed. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit_model(ephemeral)" class="doc doc-heading doc-heading-parameter">              <b><code>ephemeral</code></b>
</h4>              (<code><span title="bool">bool</span></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>Optional. Determines if the data should be treated as ephemeral. Defaults to False.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit_model(actor)" class="doc doc-heading doc-heading-parameter">              <b><code>actor</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the entity performing the commit. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.commit_model(reason)" class="doc doc-heading doc-heading-parameter">              <b><code>reason</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional description or justification for the commit operation. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="str">str</span></code>
          –
          <div class="doc-md-description">
            <p>The result of the commit operation as a string.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.MemoryStoreError">MemoryStoreError</span></code>
            –
          <div class="doc-md-description">
            <p>If the model's schema type is not registered.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.HookError">HookError</span></code>
            –
          <div class="doc-md-description">
            <p>If an error occurs during hook execution.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="k">def</span><span class="w"> </span><span class="nf">commit_model</span><span class="p">(</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">fact_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="n">ephemeral</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    Commits a model to the store using the provided schema registry and additional metadata.</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    This method registers a given `model` object with a schema type derived from its class. Metadata such</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    as `fact_id`, `source`, `session_id`, `ephemeral`, `actor`, and `reason` can be supplied to categorize</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">    or provide context for the operation. If the model&#39;s schema type is not registered, an error is raised.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        model (BaseModel): The model instance to commit.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        fact_id (str | None): Optional unique identifier for the fact. If not provided, a new UUID is generated.</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">        source (str | None): Optional source of the operation. Defaults to None.</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        session_id (str | None): Optional identifier for the session in which the commit is performed. Defaults to None.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        ephemeral (bool): Optional. Determines if the data should be treated as ephemeral. Defaults to False.</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        actor (str | None): Optional identifier for the entity performing the commit. Defaults to None.</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        reason (str | None): Optional description or justification for the commit operation. Defaults to None.</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">        The result of the commit operation as a string.</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        MemoryStoreError: If the model&#39;s schema type is not registered.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        HookError: If an error occurs during hook execution.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="n">schema_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_registry</span><span class="o">.</span><span class="n">get_type_by_model</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">schema_type</span><span class="p">:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">raise</span> <span class="n">MemoryStoreError</span><span class="p">(</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="sa">f</span><span class="s2">&quot;Model class &#39;</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; is not registered. &quot;</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="sa">f</span><span class="s2">&quot;Please call memory.register_schema(&#39;your_type_name&#39;, </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">) first.&quot;</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="n">fact</span> <span class="o">=</span> <span class="n">Fact</span><span class="p">(</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="nb">id</span><span class="o">=</span><span class="n">fact_id</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span> <span class="nb">type</span><span class="o">=</span><span class="n">schema_type</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">fact</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span> <span class="n">ephemeral</span><span class="o">=</span><span class="n">ephemeral</span><span class="p">,</span> <span class="n">actor</span><span class="o">=</span><span class="n">actor</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="n">reason</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.delete" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">delete</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">delete</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.delete(session_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.delete(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;fact_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.delete(fact_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.delete(fact_id)">fact_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;actor&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.delete(actor)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.delete(actor)">actor</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;reason&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.delete(reason)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.delete(reason)">reason</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Deletes an existing fact from storage identified by the given fact ID. This operation logs the
deletion, notifies hooks about the operation, and ensures thread safety during execution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.delete(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span> | None</code>)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the session in which the deletion is performed. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.delete(fact_id)" class="doc doc-heading doc-heading-parameter">              <b><code>fact_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the fact to be deleted.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.delete(actor)" class="doc doc-heading doc-heading-parameter">              <b><code>actor</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the user or system performing the deletion. Defaults to None if not applicable.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.delete(reason)" class="doc doc-heading doc-heading-parameter">              <b><code>reason</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional reason or context for the deletion operation. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="str">str</span></code>
          –
          <div class="doc-md-description">
            <p>The fact ID of the deleted fact.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.MemoryStoreError">MemoryStoreError</span></code>
            –
          <div class="doc-md-description">
            <p>If the fact with the given ID is not found in storage.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">    Deletes an existing fact from storage identified by the given fact ID. This operation logs the</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">    deletion, notifies hooks about the operation, and ensures thread safety during execution.</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">        session_id (str | None): Optional identifier for the session in which the deletion is performed. Defaults to None.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">        fact_id (str): The unique identifier of the fact to be deleted.</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">        actor (str | None): Optional identifier for the user or system performing the deletion. Defaults to None if not applicable.</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">        reason (str | None): Optional reason or context for the deletion operation. Defaults to None.</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">        The fact ID of the deleted fact.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">        MemoryStoreError: If the fact with the given ID is not found in storage.</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fact_id</span><span class="p">)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing</span><span class="p">:</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="k">raise</span> <span class="n">MemoryStoreError</span><span class="p">(</span><span class="s2">&quot;Fact not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fact_id</span><span class="p">)</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_tx</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">,</span> <span class="n">existing</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">,</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">existing</span><span class="p">))</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="k">return</span> <span class="n">fact_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.discard_session" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">discard_session</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">discard_session</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.discard_session(session_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.discard_session(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="int">int</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Discard a session and clear related stored data in the storage.</p>
<p>This method removes all records associated with the given session ID
from the storage and logs the operation if any data is cleared.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.discard_session(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the session to discard.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="int">int</span></code>
          –
          <div class="doc-md-description">
            <p>The number of records cleared from the storage.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="k">def</span><span class="w"> </span><span class="nf">discard_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">    Discard a session and clear related stored data in the storage.</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">    This method removes all records associated with the given session ID</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">    from the storage and logs the operation if any data is cleared.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        session_id (str): The unique identifier of the session to discard.</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">        The number of records cleared from the storage.</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="n">deleted_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="k">if</span> <span class="n">deleted_ids</span><span class="p">:</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_tx</span><span class="p">(</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="n">Operation</span><span class="o">.</span><span class="n">DISCARD_SESSION</span><span class="p">,</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="n">session_id</span><span class="p">,</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>            <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>            <span class="sa">f</span><span class="s2">&quot;Session </span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2"> cleared (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deleted_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> facts)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="p">)</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">deleted_ids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.get" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;fact_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.get(fact_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.get(fact_id)">fact_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Retrieves a fact from the storage based on the provided fact ID.</p>
<p>This method accesses the underlying storage to load a fact corresponding
to the given identifier. If the fact ID does not exist in the storage,
the method will return None.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.get(fact_id)" class="doc doc-heading doc-heading-parameter">              <b><code>fact_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the fact to retrieve.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
          –
          <div class="doc-md-description">
            <p>A dictionary representation of the fact if found, otherwise None.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    Retrieves a fact from the storage based on the provided fact ID.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    This method accesses the underlying storage to load a fact corresponding</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    to the given identifier. If the fact ID does not exist in the storage,</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    the method will return None.</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        fact_id (str): The unique identifier of the fact to retrieve.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        A dictionary representation of the fact if found, otherwise None.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fact_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.promote_session" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">promote_session</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote_session</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.promote_session(session_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.promote_session(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;selector&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.promote_session(selector)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.promote_session(selector)">selector</a></span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        <span class="n"><span title="typing.Callable">Callable</span></span><span class="p">[[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]],</span> <span class="n"><span title="bool">bool</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;actor&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.promote_session(actor)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.promote_session(actor)">actor</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;reason&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.promote_session(reason)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.promote_session(reason)">reason</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Promotes session-related facts by modifying the session ID to dissociate
them from the provided session. This is based on the selector criteria
(if provided). The promotion operation will be logged and associated hooks
will be notified.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.promote_session(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the session whose facts are to be processed for promotion.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.promote_session(selector)" class="doc doc-heading doc-heading-parameter">              <b><code>selector</code></b>
</h4>              (<code><span title="typing.Callable">Callable</span>[[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]], <span title="bool">bool</span>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A callable to filter facts based on custom logic. If
provided, only facts passing this filter will be promoted. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.promote_session(actor)" class="doc doc-heading doc-heading-parameter">              <b><code>actor</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the user or system performing the promotion operation. Defaults to None.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.promote_session(reason)" class="doc doc-heading doc-heading-parameter">              <b><code>reason</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional reason or context for the promotion operation. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="list">list</span>[<span title="str">str</span>]</code>
          –
          <div class="doc-md-description">
            <p>A list of identifiers for the promoted facts.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote_session</span><span class="p">(</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>    <span class="n">selector</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">    Promotes session-related facts by modifying the session ID to dissociate</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">    them from the provided session. This is based on the selector criteria</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">    (if provided). The promotion operation will be logged and associated hooks</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">    will be notified.</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">        session_id (str): The unique identifier of the session whose facts are to be processed for promotion.</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">        selector (Callable[[dict[str, Any]], bool] | None): A callable to filter facts based on custom logic. If</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">            provided, only facts passing this filter will be promoted. Defaults to None.</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">        actor (str | None): Optional identifier for the user or system performing the promotion operation. Defaults to None.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">        reason (str | None): Optional reason or context for the promotion operation. Defaults to None.</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">        A list of identifiers for the promoted facts.</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>        <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get_session_facts</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="n">promoted</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="k">for</span> <span class="n">fact_dict</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="k">if</span> <span class="n">selector</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">selector</span><span class="p">(</span><span class="n">fact_dict</span><span class="p">):</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                <span class="k">continue</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="n">before</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fact_dict</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="n">fact_dict</span><span class="p">[</span><span class="s2">&quot;session_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fact_dict</span><span class="p">)</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="n">promoted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fact_dict</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_log_tx</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">PROMOTE</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">fact_dict</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">before</span><span class="p">,</span> <span class="n">fact_dict</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">PROMOTE</span><span class="p">,</span> <span class="n">fact_dict</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">fact_dict</span><span class="p">))</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="k">return</span> <span class="n">promoted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.query" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">query</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">query</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;typename&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.query(typename)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.query(typename)">typename</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;filters&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.query(filters)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.query(filters)">filters</a></span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.query(session_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.query(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Executes a query against the storage with optional type and filter constraints.</p>
<p>This method interacts with the underlying storage to filter and retrieve data
based on the provided type and filtering criteria. The <code>typename</code> allows for
filtering objects of a specific type, whereas <code>filters</code> enables more fine-grained
queries by applying a JSON-based filter.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.query(typename)" class="doc doc-heading doc-heading-parameter">              <b><code>typename</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A string that specifies the type of objects to query. If set
to None, no type filtering is applied.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.query(filters)" class="doc doc-heading doc-heading-parameter">              <b><code>filters</code></b>
</h4>              (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A dictionary representing JSON-style filter constraints to
apply to the query. If set to None, no filter constraints are applied.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.query(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the session associated with the query. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
          –
          <div class="doc-md-description">
            <p>A list of dictionaries containing query results that match the given filters and type constraints.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">    Executes a query against the storage with optional type and filter constraints.</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    This method interacts with the underlying storage to filter and retrieve data</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    based on the provided type and filtering criteria. The `typename` allows for</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    filtering objects of a specific type, whereas `filters` enables more fine-grained</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    queries by applying a JSON-based filter.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        typename (str | None): A string that specifies the type of objects to query. If set</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">            to None, no type filtering is applied.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        filters (dict[str, Any] | None): A dictionary representing JSON-style filter constraints to</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">            apply to the query. If set to None, no filter constraints are applied.</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        session_id (str | None): Optional identifier for the session associated with the query. Defaults to None.</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        A list of dictionaries containing query results that match the given filters and type constraints.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="n">final_filters</span> <span class="o">=</span> <span class="p">(</span><span class="n">filters</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>    <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">final_filters</span><span class="p">[</span><span class="s2">&quot;session_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">type_filter</span><span class="o">=</span><span class="n">typename</span><span class="p">,</span> <span class="n">json_filters</span><span class="o">=</span><span class="n">final_filters</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.register_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">register_schema</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">register_schema</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;typename&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.register_schema(typename)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.register_schema(typename)">typename</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;model&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.register_schema(model)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.register_schema(model)">model</a></span><span class="p">:</span> <span class="n"><span title="type">type</span></span><span class="p">[</span><span class="n"><span title="pydantic.BaseModel">BaseModel</span></span><span class="p">],</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;constraint&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.register_schema(constraint)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.register_schema(constraint)">constraint</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Constraint&lt;/span&gt; (&lt;code&gt;memstate.storage.Constraint&lt;/code&gt;)" href="#memstate.storage.Constraint">Constraint</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Registers a schema in the schema registry and optionally applies a constraint.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.register_schema(typename)" class="doc doc-heading doc-heading-parameter">              <b><code>typename</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier for the model being registered.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.register_schema(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
</h4>              (<code><span title="type">type</span>[<span title="pydantic.BaseModel">BaseModel</span>]</code>)
          –
          <div class="doc-md-description">
            <p>The Pydantic model class to register.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.register_schema(constraint)" class="doc doc-heading doc-heading-parameter">              <b><code>constraint</code></b>
</h4>              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Constraint&lt;/span&gt; (&lt;code&gt;memstate.storage.Constraint&lt;/code&gt;)" href="#memstate.storage.Constraint">Constraint</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional constraint to associate with the type.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>None</code>
          –
          <div class="doc-md-description">
            <p>None</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="k">def</span><span class="w"> </span><span class="nf">register_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">],</span> <span class="n">constraint</span><span class="p">:</span> <span class="n">Constraint</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    Registers a schema in the schema registry and optionally applies a constraint.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        typename (str): The unique identifier for the model being registered.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        model (type[BaseModel]): The Pydantic model class to register.</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        constraint (Constraint | None): Optional constraint to associate with the type.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        None</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_schema_registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">typename</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">if</span> <span class="n">constraint</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_constraints</span><span class="p">[</span><span class="n">typename</span><span class="p">]</span> <span class="o">=</span> <span class="n">constraint</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.rollback" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">rollback</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">rollback</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;session_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.rollback(session_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.rollback(session_id)">session_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;steps&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.rollback(steps)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.rollback(steps)">steps</a></span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Reverts the state of the storage by rolling back a specified number of transactional
operations. Each operation is extracted from the transaction log and reversed based on
its type (e.g., CREATE, UPDATE, DELETE).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.rollback(session_id)" class="doc doc-heading doc-heading-parameter">              <b><code>session_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the session to roll back.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.rollback(steps)" class="doc doc-heading doc-heading-parameter">              <b><code>steps</code></b>
</h4>              (<code><span title="int">int</span></code>, default:
                  <code>1</code>
)
          –
          <div class="doc-md-description">
            <p>The number of transactional steps to roll back. Defaults to 1. Must be a positive integer.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>None</code>
          –
          <div class="doc-md-description">
            <p>None</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="k">def</span><span class="w"> </span><span class="nf">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    Reverts the state of the storage by rolling back a specified number of transactional</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">    operations. Each operation is extracted from the transaction log and reversed based on</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">    its type (e.g., CREATE, UPDATE, DELETE).</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">        session_id (str): The unique identifier of the session to roll back.</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        steps (int): The number of transactional steps to roll back. Defaults to 1. Must be a positive integer.</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">        None</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="k">if</span> <span class="n">steps</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="k">return</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get_tx_log</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">steps</span><span class="p">)</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>            <span class="n">op</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;op&quot;</span><span class="p">]</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>            <span class="n">fid</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>            <span class="k">if</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;COMMIT&quot;</span><span class="p">,</span> <span class="s2">&quot;COMMIT_EPHEMERAL&quot;</span><span class="p">,</span> <span class="s2">&quot;UPDATE&quot;</span><span class="p">,</span> <span class="s2">&quot;PROMOTE&quot;</span><span class="p">):</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">])</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">,</span> <span class="n">fid</span><span class="p">,</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>                    <span class="k">if</span> <span class="n">fid</span><span class="p">:</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="n">fid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">])</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">COMMIT</span><span class="p">,</span> <span class="n">fid</span><span class="p">,</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;fact_before&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="n">tx_uuids</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;uuid&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">]</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete_txs</span><span class="p">(</span><span class="n">tx_uuids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.search" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">search</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">search</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;query&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.search(query)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.search(query)">query</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;limit&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.search(limit)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.search(limit)">limit</a></span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;filters&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.search(filters)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.search(filters)">filters</a></span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;score_threshold&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.search(score_threshold)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.search(score_threshold)">score_threshold</a></span><span class="p">:</span> <span class="n"><span title="float">float</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="memstate.schemas.ScoredFact">ScoredFact</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Performs a hybrid search operation combining semantic search through Vector DB
with data retrieval from a storage system. This function enables the execution
of both fuzzy and precise search queries and supports filtering. The semantic
search retrieves relevant IDs and scores, while the storage system augments
these results with the most recent data associated with those IDs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.search(query)" class="doc doc-heading doc-heading-parameter">              <b><code>query</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The search term to use when querying both the vector database and the storage system.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.search(limit)" class="doc doc-heading doc-heading-parameter">              <b><code>limit</code></b>
</h4>              (<code><span title="int">int</span></code>, default:
                  <code>5</code>
)
          –
          <div class="doc-md-description">
            <p>The maximum number of results to return. Optional, with a default value of 5.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.search(filters)" class="doc doc-heading doc-heading-parameter">              <b><code>filters</code></b>
</h4>              (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A dictionary of filter conditions to apply during the search.
The filters argument supports simple key-value matching {"key": "value"} across all backends.
For complex queries (ranges, OR-logic), you must use the syntax specific to your active Vector DB.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.search(score_threshold)" class="doc doc-heading doc-heading-parameter">              <b><code>score_threshold</code></b>
</h4>              (<code><span title="float">float</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>A numeric threshold to exclude results with scores
below this value. Optional, defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="list">list</span>[<span title="memstate.schemas.ScoredFact">ScoredFact</span>]</code>
          –
          <div class="doc-md-description">
            <p>A list of <code>ScoredFact</code> objects containing facts retrieved and their associated scores.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredFact</span><span class="p">]:</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">    Performs a hybrid search operation combining semantic search through Vector DB</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">    with data retrieval from a storage system. This function enables the execution</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">    of both fuzzy and precise search queries and supports filtering. The semantic</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">    search retrieves relevant IDs and scores, while the storage system augments</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="sd">    these results with the most recent data associated with those IDs.</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">        query (str): The search term to use when querying both the vector database and the storage system.</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="sd">        limit (int): The maximum number of results to return. Optional, with a default value of 5.</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">        filters (dict[str, Any] | None): A dictionary of filter conditions to apply during the search.</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a><span class="sd">            The filters argument supports simple key-value matching {&quot;key&quot;: &quot;value&quot;} across all backends.</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">            For complex queries (ranges, OR-logic), you must use the syntax specific to your active Vector DB.</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">        score_threshold (float | None): A numeric threshold to exclude results with scores</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">            below this value. Optional, defaults to None.</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">        A list of `ScoredFact` objects containing facts retrieved and their associated scores.</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="n">search_results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SearchResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">hook</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">score_threshold</span><span class="p">)</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="n">search_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">search_results</span><span class="p">:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>    <span class="n">unique_hits</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">fact_id</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">score</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">search_results</span><span class="p">}</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="n">final_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>    <span class="k">for</span> <span class="n">fid</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">unique_hits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>            <span class="n">fact</span> <span class="o">=</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>            <span class="n">final_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ScoredFact</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">fact</span><span class="o">=</span><span class="n">fact</span><span class="p">))</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>    <span class="k">return</span> <span class="n">final_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.MemoryStore.update" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">update</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">update</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;fact_id&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.update(fact_id)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.update(fact_id)">fact_id</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;patch&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.update(patch)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.update(patch)">patch</a></span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">],</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;actor&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.update(actor)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.update(actor)">actor</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;reason&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.MemoryStore.update(reason)&lt;/code&gt;)" href="#memstate.storage.MemoryStore.update(reason)">reason</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Updates an existing fact in the store by applying a patch to its contents. The update process
validates the resulting payload using the schema registry and manages concurrent modifications
with locking. If the update fails during hook notification, the operation is rolled back
to its previous state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.update(fact_id)" class="doc doc-heading doc-heading-parameter">              <b><code>fact_id</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier of the fact to be updated.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.update(patch)" class="doc doc-heading doc-heading-parameter">              <b><code>patch</code></b>
</h4>              (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>)
          –
          <div class="doc-md-description">
            <p>A dictionary representing the modifications to be applied to the current fact's payload.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.update(actor)" class="doc doc-heading doc-heading-parameter">              <b><code>actor</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional identifier for the user or system performing the update. Defaults to None if not applicable.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.MemoryStore.update(reason)" class="doc doc-heading doc-heading-parameter">              <b><code>reason</code></b>
</h4>              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional reason or context for the update operation. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="str">str</span></code>
          –
          <div class="doc-md-description">
            <p>The unique identifier of the updated fact.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.MemoryStoreError">MemoryStoreError</span></code>
            –
          <div class="doc-md-description">
            <p>If the fact with the specified identifier is not found in the store.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.HookError">HookError</span></code>
            –
          <div class="doc-md-description">
            <p>If an error occurs during the hook notification process.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">patch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">    Updates an existing fact in the store by applying a patch to its contents. The update process</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    validates the resulting payload using the schema registry and manages concurrent modifications</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">    with locking. If the update fails during hook notification, the operation is rolled back</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">    to its previous state.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">        fact_id (str): The unique identifier of the fact to be updated.</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        patch (dict[str, Any]): A dictionary representing the modifications to be applied to the current fact&#39;s payload.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        actor (str | None): Optional identifier for the user or system performing the update. Defaults to None if not applicable.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">        reason (str | None): Optional reason or context for the update operation. Defaults to None.</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">        The unique identifier of the updated fact.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">        MemoryStoreError: If the fact with the specified identifier is not found in the store.</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">        HookError: If an error occurs during the hook notification process.</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fact_id</span><span class="p">)</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing</span><span class="p">:</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="k">raise</span> <span class="n">MemoryStoreError</span><span class="p">(</span><span class="s2">&quot;Fact not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">before</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">draft</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="n">current_payload</span> <span class="o">=</span> <span class="n">draft</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="n">patch_payload</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="n">current_payload</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">patch_payload</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="n">fact_type</span> <span class="o">=</span> <span class="n">draft</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">validated_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_registry</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">fact_type</span><span class="p">,</span> <span class="n">current_payload</span><span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="n">draft</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">validated_payload</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="n">draft</span><span class="p">[</span><span class="s2">&quot;ts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">draft</span><span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_log_tx</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">,</span> <span class="n">draft</span><span class="p">[</span><span class="s2">&quot;session_id&quot;</span><span class="p">],</span> <span class="n">fact_id</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">draft</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_notify_hooks</span><span class="p">(</span><span class="n">Operation</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">,</span> <span class="n">fact_id</span><span class="p">,</span> <span class="n">Fact</span><span class="p">(</span><span class="o">**</span><span class="n">draft</span><span class="p">))</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="k">except</span> <span class="n">HookError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="k">return</span> <span class="n">fact_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memstate.storage.SchemaRegistry" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">SchemaRegistry</span>


</h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">SchemaRegistry</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">



        <p>Manages schema registration and validation with a mapping of type names to Pydantic models.</p>
<p>The SchemaRegistry class allows for the registration of Pydantic models with associated type names.
It provides functionality for validating payloads against the registered schemas and for reverse-
looking up type names by model classes.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><span title="memstate.storage.SchemaRegistry.schemas">schemas</span></code></b>
              (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="type">type</span>[<span title="pydantic.BaseModel">BaseModel</span>]]</code>)
          –
          <div class="doc-md-description">
            <p>A mapping of type names to their registered Pydantic models.</p>
          </div>
        </li>
    </ul>

          











<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;get_type_by_model&lt;/span&gt; (&lt;code&gt;memstate.storage.SchemaRegistry.get_type_by_model&lt;/code&gt;)" href="#memstate.storage.SchemaRegistry.get_type_by_model">get_type_by_model</a></code></b>
            –
            <div class="doc-md-description">
              <p>Retrieve the type name associated with a given model class.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;register&lt;/span&gt; (&lt;code&gt;memstate.storage.SchemaRegistry.register&lt;/code&gt;)" href="#memstate.storage.SchemaRegistry.register">register</a></code></b>
            –
            <div class="doc-md-description">
              <p>Registers a model under a specific type name within the schema registry.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;validate&lt;/span&gt; (&lt;code&gt;memstate.storage.SchemaRegistry.validate&lt;/code&gt;)" href="#memstate.storage.SchemaRegistry.validate">validate</a></code></b>
            –
            <div class="doc-md-description">
              <p>Validates the given payload against the model schema for the specified type name. If no schema</p>
            </div>
          </li>
    </ul>



                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>memstate/storage.py</code></summary>
                    <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memstate.storage.SchemaRegistry.get_type_by_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_type_by_model</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_type_by_model</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;model_class&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.SchemaRegistry.get_type_by_model(model_class)&lt;/code&gt;)" href="#memstate.storage.SchemaRegistry.get_type_by_model(model_class)">model_class</a></span><span class="p">:</span> <span class="n"><span title="type">type</span></span><span class="p">[</span><span class="n"><span title="pydantic.BaseModel">BaseModel</span></span><span class="p">],</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Retrieve the type name associated with a given model class.</p>
<p>This method iterates through a dictionary of schemas and checks if the
provided model class matches any value in the dictionary. If a match is
found, the corresponding type name is returned. If no match is found, it
returns None.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.SchemaRegistry.get_type_by_model(model_class)" class="doc doc-heading doc-heading-parameter">              <b><code>model_class</code></b>
</h4>              (<code><span title="type">type</span>[<span title="pydantic.BaseModel">BaseModel</span>]</code>)
          –
          <div class="doc-md-description">
            <p>The Pydantic model class to find the corresponding type name for.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="str">str</span> | None</code>
          –
          <div class="doc-md-description">
            <p>The type name associated with the provided model class, or None if no match is found.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_type_by_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Retrieve the type name associated with a given model class.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    This method iterates through a dictionary of schemas and checks if the</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    provided model class matches any value in the dictionary. If a match is</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    found, the corresponding type name is returned. If no match is found, it</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    returns None.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        model_class (type[BaseModel]): The Pydantic model class to find the corresponding type name for.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        The type name associated with the provided model class, or None if no match is found.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">for</span> <span class="n">type_name</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">if</span> <span class="bp">cls</span> <span class="o">==</span> <span class="n">model_class</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="k">return</span> <span class="n">type_name</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.SchemaRegistry.register" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">register</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">register</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;typename&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.SchemaRegistry.register(typename)&lt;/code&gt;)" href="#memstate.storage.SchemaRegistry.register(typename)">typename</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;model&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.SchemaRegistry.register(model)&lt;/code&gt;)" href="#memstate.storage.SchemaRegistry.register(model)">model</a></span><span class="p">:</span> <span class="n"><span title="type">type</span></span><span class="p">[</span><span class="n"><span title="pydantic.BaseModel">BaseModel</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Registers a model under a specific type name within the schema registry.</p>
<p>This method associates a given model with a unique type name in the internal
schema registry. The registered type name and model can later be retrieved or
used for validation or other processing purposes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.SchemaRegistry.register(typename)" class="doc doc-heading doc-heading-parameter">              <b><code>typename</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The unique identifier for the model being registered.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.SchemaRegistry.register(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
</h4>              (<code><span title="type">type</span>[<span title="pydantic.BaseModel">BaseModel</span>]</code>)
          –
          <div class="doc-md-description">
            <p>The Pydantic model class to register.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>None</code>
          –
          <div class="doc-md-description">
            <p>None</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Registers a model under a specific type name within the schema registry.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    This method associates a given model with a unique type name in the internal</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    schema registry. The registered type name and model can later be retrieved or</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    used for validation or other processing purposes.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        typename (str): The unique identifier for the model being registered.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        model (type[BaseModel]): The Pydantic model class to register.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        None</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">[</span><span class="n">typename</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memstate.storage.SchemaRegistry.validate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">validate</span>


</h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">validate</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;typename&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.SchemaRegistry.validate(typename)&lt;/code&gt;)" href="#memstate.storage.SchemaRegistry.validate(typename)">typename</a></span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;b&gt;&lt;code&gt;payload&lt;/code&gt;&lt;/b&gt; (&lt;code&gt;memstate.storage.SchemaRegistry.validate(payload)&lt;/code&gt;)" href="#memstate.storage.SchemaRegistry.validate(payload)">payload</a></span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validates the given payload against the model schema for the specified type name. If no schema
exists for the provided type name, the payload is returned unmodified. If validation fails, an
exception containing the details of the validation failure is raised.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.SchemaRegistry.validate(typename)" class="doc doc-heading doc-heading-parameter">              <b><code>typename</code></b>
</h4>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The type name for which the payload is to be validated.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="memstate.storage.SchemaRegistry.validate(payload)" class="doc doc-heading doc-heading-parameter">              <b><code>payload</code></b>
</h4>              (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>)
          –
          <div class="doc-md-description">
            <p>The dictionary payload to be validated against the corresponding model schema.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
          –
          <div class="doc-md-description">
            <p>A dictionary containing the validated payload in JSON-serializable format.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="memstate.exceptions.ValidationFailed">ValidationFailed</span></code>
            –
          <div class="doc-md-description">
            <p>If the input payload fails validation against the schema.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>memstate/storage.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    Validates the given payload against the model schema for the specified type name. If no schema</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    exists for the provided type name, the payload is returned unmodified. If validation fails, an</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    exception containing the details of the validation failure is raised.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        typename (str): The type name for which the payload is to be validated.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        payload (dict[str, Any]): The dictionary payload to be validated against the corresponding model schema.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        A dictionary containing the validated payload in JSON-serializable format.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        ValidationFailed: If the input payload fails validation against the schema.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">model_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">typename</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">model_cls</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">return</span> <span class="n">payload</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">instance</span> <span class="o">=</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="k">raise</span> <span class="n">ValidationFailed</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate", "content.tooltips", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>